<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Caching - Victor Code Notes</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Caching";
    var mkdocs_page_input_path = "spring\\caching.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Victor Code Notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Code Notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../bash/">Bash</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Big Data</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../bigdata/hive/">Hive</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../bigdata/parquet/">Parquet</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Spark</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../spark/spark/">DataFrames</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../spark/structured_streaming/">Structured Streaming</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Docker</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/cloudera/">Cloudera Quickstart</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/jupyter/">Jupyter Notebooks</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/kind/">Kubernetes</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/sqlserver/">SQL Server</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">ElasticSearch</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../elasticsearch/geohashing/">Geographical</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Git</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../git/ssh-clone/">SSH Usage</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Go</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../go/go_docker/">Basic Docker image</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Java</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../java/crypto/">Cryptography</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/jvm/">JVM</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/properties/">File/URL/HDFS Properties</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../python/python_clients/">OpenApi Python client</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Scala</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../scala/cheatsheets/">Cheatsheets</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../scala/parallel/">Parallel Collections</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../scala/json/">Parse a JSON</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Spring</span>
    <ul class="subnav">
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Caching</a>
    <ul class="subnav">
            
    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../cloud/">Cloud</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Core</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../core/">Datasources</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../core_profiles/">Profiles</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../core_ssl/">SSL Support</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../batch/">Batch</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../integration/">Integration</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Security</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../security_basic/">Basic Setup</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../security_method/">Method Security</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../spring_io_sessions/">Spring IO 2018</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Victor Code Notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Spring &raquo;</li>
        
      
        
          <li>Code Notes &raquo;</li>
        
      
    
    <li>Caching</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Caching with EHCache in Spring-Boot</p>
<p>Dependencies needed</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;javax.cache&lt;/groupId&gt;
    &lt;artifactId&gt;cache-api&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
     &lt;groupId&gt;org.ehcache&lt;/groupId&gt;
     &lt;artifactId&gt;ehcache&lt;/artifactId&gt;
    &lt;version&gt;${ehcache.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>Spring Configuration Class</p>
<pre><code>@Configuration
@EnableCaching
public class CacheConfiguration {

    // Implement your own key generator if needed
    @Bean
    public KeyGenerator requestKeyGenerator() {
        return new KeyGenerator() {

            @Override
            public Object generate(Object target, Method method, Object... params) {...}
        }}

    // Implement a bean exposing a boolean method checking whether a request should be cached
    @Bean
    public CacheControl cacheControl() {
        return new cacheControl();
    }


    static class CacheControl {
        public boolean checkIfCachingIsNeeded(BusinessRequest request) {...}}

}
</code></pre>

<p>How to mark a method as <code>Cacheable</code>:</p>
<pre><code>@Cacheable(cacheNames=&quot;my_cache&quot;, keyGenerator=&quot;requestKeyGenerator&quot;,condition=&quot;@cacheControl.checkIfCachingIsNeeded(#a0)&quot;)
public BusinessResponse execute(BusinessRequest request){
...
}
</code></pre>

<p>Note that <code>BusinessResponse</code> should be serializable so it can be stored in the different cache levels.</p>
<p>EHCache XML configuration</p>
<pre><code>&lt;config xmlns='http://www.ehcache.org/v3'
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xmlns:jsr107=&quot;http://www.ehcache.org/v3/jsr107&quot;
        xsi:schemaLocation=&quot;http://www.ehcache.org/v3 http://www.ehcache.org/schema/ehcache-core-3.5.xsd
                            http://www.ehcache.org/v3/jsr107 http://www.ehcache.org/schema/ehcache-107-ext-3.5.xsd&quot;&gt;

    &lt;persistence directory=&quot;./target&quot;/&gt;

    &lt;cache alias=&quot;my_cache&quot; &gt;

        &lt;key-type copier=&quot;org.ehcache.impl.copy.SerializingCopier&quot;&gt;java.lang.String&lt;/key-type&gt;
        &lt;value-type copier=&quot;org.ehcache.impl.copy.SerializingCopier&quot;&gt;org.mycompany.bussiness.BusinessResponse&lt;/value-type&gt;

        &lt;!--Entries in this cache will not expire --&gt;
        &lt;expiry&gt;
            &lt;none/&gt;
        &lt;/expiry&gt;

        &lt;!-- Cache entries will be stored in head memory, then off heap RAM and finally disk
             Most used records will be in heap, then RAM and the least used will go to disk
         --&gt;
        &lt;resources&gt;
            &lt;heap unit=&quot;MB&quot;&gt;512&lt;/heap&gt;
            &lt;offheap unit=&quot;MB&quot;&gt;2048&lt;/offheap&gt;
            &lt;disk unit=&quot;MB&quot;&gt;5096&lt;/disk&gt;
        &lt;/resources&gt;
        &lt;jsr107:mbeans enable-statistics=&quot;true&quot;/&gt;
    &lt;/cache&gt;
&lt;/config&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cloud/" class="btn btn-neutral float-right" title="Cloud">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../scala/json/" class="btn btn-neutral" title="Parse a JSON"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../scala/json/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../cloud/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
